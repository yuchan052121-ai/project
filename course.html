{% extends "layout.html" %}
{% block content %}
<h2>{{ course['code'] }} — {{ course['title'] }}</h2>

<form method="get" action="{{ url_for('course_view', course_id=course['id']) }}">
  <label>評価フィルタ（最小）:
    <select name="min_rating" onchange="this.form.submit()">
      <option value="">すべて</option>
      {% for r in [5,4,3,2,1] %}
        <option value="{{ r }}" {% if min_rating==r %}selected{% endif %}>{{ r }} 以上</option>
      {% endfor %}
    </select>
  </label>
</form>

<p>合計レビュー: {{ total }}</p>

{% if reviews %}
  <ul class="reviews">
  {% for r in reviews %}
    <li>
      <strong>評価: {{ r['rating'] }}</strong>
      <span class="meta">（投稿: {{ r['created_at'] }}）</span>
      <div class="comment">{{ r['comment'] }}</div>
    </li>
  {% endfor %}
  </ul>

  <div class="pager">
    {% if has_prev %}
      <a href="{{ url_for('course_view', course_id=course['id'], page=page-1, min_rating=min_rating) }}">&laquo; 前へ</a>
    {% endif %}
    <span>ページ {{ page }} / {{ pages }}</span>
    {% if has_next %}
      <a href="{{ url_for('course_view', course_id=course['id'], page=page+1, min_rating=min_rating) }}">次へ &raquo;</a>
    {% endif %}
  </div>
{% else %}
  <p>レビューはまだありません。</p>
{% endif %}

<hr>
<p>
  <a href="{{ url_for('add_review', course_id=course['id']) }}">この科目にレビューを書く</a>
</p>

<!-- 取消フォーム（名前を入れるとそのユーザーの最新レビューを取消） -->
<form method="post" action="{{ url_for('cancel_review', course_id=course['id']) }}">
  <label>取消するレビューの名前（投稿時と同じ名前）: <input name="name" required></label>
  <button type="submit">取消する</button>
</form>

{% endblock %}
